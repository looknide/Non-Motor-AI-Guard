  <!-- ç¼–è¾‘èµ„æ–™æ¨¡æ€çª—å£ -->
    <div class="modal" id="edit-profile-modal">
        <div class="modal-content">
            <span class="modal-close" id="edit-profile-close">&times;</span>
            <h2 class="modal-title">ç¼–è¾‘ä¸ªäººèµ„æ–™</h2>
            <form class="modal-form" id="edit-profile-form">
                <div class="form-group">
                    <label for="edit-name">å§“å</label>
                    <input type="text" id="edit-name" class="form-input" value="ææ˜">
                </div>
                <div class="form-group">
                    <label for="edit-position">èŒä½</label>
                    <input type="text" id="edit-position" class="form-input" value="é«˜çº§äº¤é€šç›‘å¯Ÿå‘˜">
                </div>
                <div class="form-group">
                    <label for="edit-phone">ç”µè¯</label>
                    <input type="text" id="edit-phone" class="form-input" value="13812346542">
                </div>
                <div class="form-group">
                    <label for="edit-email">é‚®ç®±</label>
                    <input type="email" id="edit-email" class="form-input" value="li.ming@traffic.gov.cn">
                </div>
                <div class="form-group">
                    <label for="edit-department">æ‰€å±éƒ¨é—¨</label>
                    <input type="text" id="edit-department" class="form-input" value="åŸä¸œåŒºäº¤é€šç®¡ç†ä¸­å¿ƒ">
                </div>
                <button type="submit" class="form-submit">ä¿å­˜ä¿®æ”¹</button>
            </form>
        </div>
    </div>
    
    <!-- æŠ¥å‘Šé—®é¢˜æ¨¡æ€çª—å£ -->
    <div class="modal" id="report-issue-modal">
        <div class="modal-content">
            <span class="modal-close" id="report-issue-close">&times;</span>
            <h2 class="modal-title">æŠ¥å‘Šç³»ç»Ÿé—®é¢˜</h2>
            <form class="modal-form" id="report-issue-form">
                <div class="form-group">
                    <label for="issue-type">é—®é¢˜ç±»å‹</label>
                    <select id="issue-type" class="form-input">
                        <option value="bug">ç³»ç»Ÿé”™è¯¯</option>
                        <option value="suggestion">åŠŸèƒ½å»ºè®®</option>
                        <option value="data">æ•°æ®å¼‚å¸¸</option>
                        <option value="permission">æƒé™é—®é¢˜</option>
                        <option value="other">å…¶ä»–é—®é¢˜</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="issue-title">é—®é¢˜æ ‡é¢˜</label>
                    <input type="text" id="issue-title" class="form-input" placeholder="è¯·ç®€è¦æè¿°é—®é¢˜">
                </div>
                <div class="form-group">
                    <label for="issue-description">è¯¦ç»†æè¿°</label>
                    <textarea id="issue-description" class="form-textarea" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜..."></textarea>
                </div>
                <div class="form-group">
                    <label for="issue-attachment">é™„ä»¶ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="file" id="issue-attachment" class="form-input">
                </div>
                <button type="submit" class="form-submit">æäº¤é—®é¢˜</button>
            </form>
        </div>
    </div><!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NON-MOTOR AI GUARD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #0a0a1a;
            color: #ffffff;
            min-height: 100vh;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 240px;
            background: linear-gradient(180deg, #151540 0%, #0d0d2d 100%);
            padding: 20px 0;
            border-right: 1px solid #2a2a5a;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .sidebar-title {
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 2px;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(150, 100, 255, 0.7);
            text-align: center;
            margin-bottom: 30px;
            padding: 0 10px;
        }
        
        .sidebar-nav {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding-top: 30px;
        }
        
        .nav-button {
            display: block;
            width: 80%;
            margin: 10px auto;
            padding: 12px 0;
            text-align: center;
            background: linear-gradient(90deg, #1a1a4a 0%, #232368 100%);
            color: #ffffff;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-button:hover {
            background: linear-gradient(90deg, #2a2a7a 0%, #3333a8 100%);
            box-shadow: 0 0 15px rgba(100, 100, 255, 0.5);
            transform: translateX(5px);
        }
        
        .hamburger {
            display: none;
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .main-header {
            text-align: center;
            padding-bottom: 20px;
        }
        
        .main-title {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 3px;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(150, 100, 255, 0.7);
        }
        
        .dashboard {
            display: flex;
            flex: 1;
            height: calc(100vh - 100px);
        }
        
        .content-container {
            flex: 3;
            display: flex;
            flex-direction: column;
            margin-right: 20px;
        }
        
        /* Chat Interface Styles */
        .chat-window {
            background-color: rgba(30, 30, 60, 0.4);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            position: relative;
            height: calc(100vh - 130px);
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            margin-bottom: 15px;
            /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
            scrollbar-width: thin;
            scrollbar-color: rgba(170, 93, 249, 0.5) rgba(40, 40, 100, 0.2);
        }
        
        /* Webkitæµè§ˆå™¨çš„æ»šåŠ¨æ¡æ ·å¼ */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: rgba(40, 40, 100, 0.2);
            border-radius: 10px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(170, 93, 249, 0.5);
            border-radius: 10px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(170, 93, 249, 0.8);
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: #2a2a7a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .message.user .message-avatar {
            order: 2;
            margin-left: 10px;
            margin-right: 0;
            background-color: #aa5df9;
        }
        
        .message-content {
            background: linear-gradient(135deg, rgba(40, 40, 100, 0.6) 0%, rgba(60, 60, 150, 0.4) 100%);
            padding: 12px 15px;
            border-radius: 18px;
            max-width: 70%;
            word-break: break-word;
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, rgba(170, 93, 249, 0.6) 0%, rgba(130, 70, 200, 0.4) 100%);
            text-align: right;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
            position: relative;
        }
        
        .chat-input {
            flex: 1;
            background-color: rgba(50, 50, 100, 0.4);
            border: 1px solid rgba(100, 100, 255, 0.3);
            border-radius: 25px;
            padding: 12px 50px 12px 20px;
            color: white;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .chat-input:focus {
            border-color: rgba(170, 93, 249, 0.6);
            box-shadow: 0 0 10px rgba(170, 93, 249, 0.4);
        }
        
        .image-upload {
            position: absolute;
            right: 145px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #aa5df9;
            cursor: pointer;
            font-size: 24px;
        }
        
        .send-button {
            background: linear-gradient(90deg, #aa5df9 0%, #8246c8 100%);
            border: none;
            border-radius: 25px;
            padding: 0 25px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .send-button:hover {
            box-shadow: 0 0 15px rgba(170, 93, 249, 0.5);
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 150px;
            margin-top: 10px;
            border-radius: 10px;
            display: none;
        }
        
        #fileInput {
            display: none;
        }
        
        /* ç”¨æˆ·èµ„æ–™åŒºåŸŸæ ·å¼ */
        .user-profile {
            background-color: rgba(30, 30, 60, 0.4);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 350px;
        }
        
        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            overflow: hidden;
            margin-bottom: 15px;
            border: 3px solid rgba(170, 93, 249, 0.7);
            position: relative;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-edit {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(40, 40, 100, 0.8);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .avatar-edit:hover {
            background: rgba(170, 93, 249, 0.8);
        }
        
        .avatar-edit label {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }
        
        #avatar-upload {
            display: none;
        }
        
        .profile-name {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .profile-name h3 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #fff;
        }
        
        .badge {
            background: linear-gradient(90deg, #2a2a7a 0%, #3333a8 100%);
            color: #fff;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .profile-info {
            margin-bottom: 30px;
        }
        
        .info-group {
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(100, 100, 255, 0.2);
            padding-bottom: 10px;
        }
        
        .info-group label {
            display: block;
            color: #8889ce;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .info-group div {
            color: #fff;
            font-size: 16px;
        }
        
        .profile-actions {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .profile-btn {
            background: linear-gradient(90deg, #2a2a7a 0%, #3333a8 100%);
            border: none;
            border-radius: 5px;
            padding: 12px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .profile-btn:hover {
            background: linear-gradient(90deg, #3333a8 0%, #4444c2 100%);
            box-shadow: 0 0 15px rgba(100, 100, 255, 0.5);
        }
        
        .report-btn {
            background: linear-gradient(90deg, #5a1e5a 0%, #8a2e8a 100%);
        }
        
        .report-btn:hover {
            background: linear-gradient(90deg, #8a2e8a 0%, #a53ea5 100%);
            box-shadow: 0 0 15px rgba(170, 93, 249, 0.5);
        }
        
        /* æ¨¡æ€çª—å£æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(30, 30, 80, 0.95) 0%, rgba(20, 20, 60, 0.95) 100%);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 0 30px rgba(100, 100, 255, 0.5);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            color: #aa5df9;
        }
        
        .modal-title {
            margin-bottom: 20px;
            color: #fff;
            font-size: 20px;
            text-align: center;
        }
        
        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 10px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #bcbcff;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 15px;
            background-color: rgba(40, 40, 100, 0.3);
            border: 1px solid rgba(100, 100, 255, 0.3);
            border-radius: 5px;
            color: #fff;
            font-size: 16px;
        }
        
        .form-textarea {
            width: 100%;
            padding: 10px 15px;
            background-color: rgba(40, 40, 100, 0.3);
            border: 1px solid rgba(100, 100, 255, 0.3);
            border-radius: 5px;
            color: #fff;
            font-size: 16px;
            min-height: 120px;
            resize: vertical;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: rgba(170, 93, 249, 0.6);
            box-shadow: 0 0 10px rgba(170, 93, 249, 0.4);
        }
        
        .form-submit {
            margin-top: 10px;
            background: linear-gradient(90deg, #aa5df9 0%, #8246c8 100%);
            border: none;
            border-radius: 5px;
            padding: 12px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .form-submit:hover {
            background: linear-gradient(90deg, #bb6eff 0%, #9257d9 100%);
            box-shadow: 0 0 15px rgba(170, 93, 249, 0.5);
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 992px) {
            .user-profile {
                max-width: none;
            }
            
            .profile-header {
                flex-direction: row;
                align-items: center;
                justify-content: flex-start;
                gap: 20px;
            }
            
            .profile-avatar {
                width: 80px;
                height: 80px;
                margin-bottom: 0;
            }
        }
        
        @media (max-width: 992px) {
            .dashboard {
                flex-direction: column;
            }
            
            .content-container {
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            .data-summary {
                min-height: 400px;
            }
        }
        
        @media (max-width: 768px) {
            .hamburger {
                display: block;
            }
            
            .sidebar {
                position: fixed;
                left: -240px;
                height: 100vh;
                z-index: 999;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .main-content {
                width: 100%;
                margin-left: 0;
            }
            
            .chat-window {
                height: calc(100vh - 150px);
            }
        }
        
        @media (max-width: 480px) {
            .main-title {
                font-size: 22px;
            }
            
            .chat-window {
                height: calc(100vh - 120px);
            }
            
            .message-content {
                max-width: 85%;
            }
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #aa5df9;
            font-size: 18px;
        }
        
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff6666;
            font-size: 16px;
            text-align: center;
        }
        
        /* Typing indicator */
        .typing-indicator {
            display: none;
            padding: 10px;
            background: rgba(40, 40, 100, 0.4);
            border-radius: 20px;
            width: 70px;
            margin-left: 50px;
        }
        
        .typing-indicator span {
            height: 10px;
            width: 10px;
            float: left;
            margin: 0 1px;
            background-color: #aa5df9;
            display: block;
            border-radius: 50%;
            opacity: 0.4;
            animation: typing 1s infinite;
        }
        
        .typing-indicator span:nth-of-type(1) { animation-delay: 0s; }
        .typing-indicator span:nth-of-type(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-of-type(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="hamburger" id="menu-toggle">â˜°</button>
        
        <div class="sidebar" id="sidebar">
            <div class="sidebar-title">NON-MOTOR AI GUARD</div>
            <div class="sidebar-nav">
                <button class="nav-button" id="home-btn">ç™»å½•é¡µ</button>
                <button class="nav-button" id="dashboard-btn">ä¸»é¡µ</button>
                <button class="nav-button" id="details-btn">è¯¦æƒ…é¡µ</button>
                <button class="nav-button active" id="vlm-btn">æ™ºèƒ½äº¤äº’é¡µ</button>
                <button class="nav-button" id="review-btn">ç”³è¯·å¤æ ¸</button>
                <button class="nav-button" id="contact-btn">è”ç³»å¼€å‘å•†</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="main-header">
                <h1 class="main-title">éæœºåŠ¨è½¦æ™ºèƒ½ç›‘æ§ç³»ç»Ÿ</h1>
            </div>
            
            <div class="dashboard">
                <div class="content-container">
                    <div class="chat-window">
                        <div class="chat-messages" id="chatMessages">
                            <div class="message">
                                <div class="message-avatar">åŠ©æ‰‹</div>
                                <div class="message-content">
                                    ä½ å¥½ï¼æˆ‘æ˜¯éæœºåŠ¨è½¦æ™ºèƒ½ç›‘æ§ç³»ç»Ÿçš„AIåŠ©æ‰‹ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ
                                </div>
                            </div>
                        </div>
                        
                        <div class="typing-indicator" id="typingIndicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        
                        <img id="imagePreview" class="image-preview" src="" alt="å›¾ç‰‡é¢„è§ˆ">
                        
                        <div class="chat-input-container">
                            <input type="text" class="chat-input" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." autocomplete="off">
                            <label for="fileInput" class="image-upload">ğŸ“·</label>
                            <input type="file" id="fileInput" accept="image/*">
                            <button class="send-button" id="sendButton">å‘é€</button>
                        </div>
                    </div>
                </div>
                
                <div class="data-summary user-profile">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <img src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" alt="ç”¨æˆ·å¤´åƒ" id="profile-image">
                            <div class="avatar-edit">
                                <label for="avatar-upload" title="æ›´æ¢å¤´åƒ">ğŸ“·</label>
                                <input type="file" id="avatar-upload" accept="image/*">
                            </div>
                        </div>
                        <div class="profile-name">
                            <h3 id="user-name">ææ˜</h3>
                            <div class="badge">å·²è®¤è¯</div>
                        </div>
                    </div>
                    
                    <div class="profile-info">
                        <div class="info-group">
                            <label>èŒä½</label>
                            <div id="user-position">äº¤é€šè­¦å«å¤„ Â· é«˜çº§äº¤é€šç›‘å¯Ÿå‘˜</div>
                        </div>
                        <div class="info-group">
                            <label>è­¦å‘˜ç¼–å·</label>
                            <div id="user-id">TPC-20210734</div>
                        </div>
                        <div class="info-group">
                            <label>ç”µè¯</label>
                            <div id="user-phone">138****6542</div>
                        </div>
                        <div class="info-group">
                            <label>é‚®ç®±</label>
                            <div id="user-email">li.ming@traffic.gov.cn</div>
                        </div>
                        <div class="info-group">
                            <label>æ‰€å±éƒ¨é—¨</label>
                            <div id="user-department">åŸä¸œåŒºäº¤é€šç®¡ç†ä¸­å¿ƒ</div>
                        </div>
                        <div class="info-group">
                            <label>å…¥èŒæ—¶é—´</label>
                            <div id="user-join-date">2021-07-15</div>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button id="edit-profile-btn" class="profile-btn">ç¼–è¾‘èµ„æ–™</button>
                        <button id="report-issue-btn" class="profile-btn report-btn">æŠ¥å‘Šç³»ç»Ÿé—®é¢˜</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
    <script type="module">
        // Google AI API Key
        const API_KEY = 'AIzaSyDsGrmSxmKo3lTW4Ukk4TtRMRbdt_noFZY';
        
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // åˆå§‹åŒ– Google Generative AI
        const genAI = new GoogleGenerativeAI(API_KEY);
        
        // è·å–Geminiæ¨¡å‹
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        
        // åˆ›å»ºå¼¹çª—å…ƒç´ 
        function createModal(content) {
            // åˆ é™¤å·²æœ‰çš„å¼¹çª—ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const existingModal = document.querySelector('.modal-container');
            if (existingModal) {
                existingModal.remove();
            }
            
            // åˆ›å»ºæ–°å¼¹çª—
            const modalContainer = document.createElement('div');
            modalContainer.className = 'modal-container';
            modalContainer.style.position = 'fixed';
            modalContainer.style.top = '0';
            modalContainer.style.left = '0';
            modalContainer.style.width = '100%';
            modalContainer.style.height = '100%';
            modalContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            modalContainer.style.display = 'flex';
            modalContainer.style.justifyContent = 'center';
            modalContainer.style.alignItems = 'center';
            modalContainer.style.zIndex = '9999';
            
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            modalContent.style.backgroundColor = 'rgba(30, 30, 80, 0.95)';
            modalContent.style.padding = '30px';
            modalContent.style.borderRadius = '10px';
            modalContent.style.boxShadow = '0 0 20px rgba(150, 100, 255, 0.5)';
            modalContent.style.textAlign = 'center';
            modalContent.style.maxWidth = '400px';
            modalContent.style.width = '90%';
            modalContent.style.color = 'white';
            modalContent.style.border = '1px solid rgba(150, 100, 255, 0.3)';
            
            modalContent.innerHTML = content;
            
            const closeButton = document.createElement('button');
            closeButton.textContent = 'å…³é—­';
            closeButton.style.marginTop = '20px';
            closeButton.style.padding = '8px 20px';
            closeButton.style.backgroundColor = 'rgba(120, 80, 220, 0.8)';
            closeButton.style.border = 'none';
            closeButton.style.borderRadius = '5px';
            closeButton.style.color = 'white';
            closeButton.style.cursor = 'pointer';
            
            closeButton.addEventListener('click', () => {
                modalContainer.remove();
            });
            
            modalContent.appendChild(closeButton);
            modalContainer.appendChild(modalContent);
            document.body.appendChild(modalContainer);
        }

        // Chat interface functions
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');
        const typingIndicator = document.getElementById('typingIndicator');
        
        let selectedFile = null;
        
        // å°†Fileå¯¹è±¡è½¬æ¢ä¸ºGenerativePart
        async function fileToGenerativePart(file) {
            const base64EncodedDataPromise = new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result.split(',')[1]);
                reader.readAsDataURL(file);
            });
            return {
                inlineData: { 
                    data: await base64EncodedDataPromise, 
                    mimeType: file.type 
                },
            };
        }
        
        // Add user message to chat
        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            
            messageDiv.innerHTML = `
                <div class="message-content">${text}</div>
                <div class="message-avatar">ç”¨æˆ·</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Add bot message to chat
        function addBotMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">åŠ©æ‰‹</div>
                <div class="message-content">${text}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Handle image upload
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            selectedFile = file;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });
        
        // åˆ›å»ºèŠå¤©å¯¹è±¡
        let chat = model.startChat({
            history: [
                {
                    role: "user",
                    parts: [{ text: "ä½ å¥½ï¼Œè¯·ä»¥éæœºåŠ¨è½¦æ™ºèƒ½ç›‘æ§ç³»ç»Ÿçš„åŠ©æ‰‹çš„èº«ä»½ä¸æˆ‘äº¤æµã€‚" }],
                },
                {
                    role: "model",
                    parts: [{ text: "ä½ å¥½ï¼æˆ‘æ˜¯éæœºåŠ¨è½¦æ™ºèƒ½ç›‘æ§ç³»ç»Ÿçš„åŠ©æ‰‹ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ" }],
                },
            ],
        });
        
        // Handle sending messages
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message && !selectedFile) return;
            
            // Clear input
            chatInput.value = '';
            
            // Add user message to chat
            if (message) {
                addUserMessage(message);
            }
            
            // å¦‚æœæœ‰å›¾ç‰‡ï¼Œå¤„ç†å›¾ç‰‡
            let parts = [{ text: message }];
            
            if (selectedFile) {
                try {
                    const imagePart = await fileToGenerativePart(selectedFile);
                    parts.push(imagePart);
                    
                    // åœ¨èŠå¤©ä¸­æ˜¾ç¤ºå›¾ç‰‡
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message user';
                    
                    const img = document.createElement('img');
                    img.src = imagePreview.src;
                    img.style.maxWidth = '200px';
                    img.style.borderRadius = '10px';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    contentDiv.appendChild(img);
                    
                    messageDiv.appendChild(contentDiv);
                    messageDiv.innerHTML += `<div class="message-avatar">ç”¨æˆ·</div>`;
                    
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                } catch (error) {
                    console.error('å¤„ç†å›¾ç‰‡å¤±è´¥:', error);
                }
                
                // Reset image preview
                imagePreview.style.display = 'none';
                imagePreview.src = '';
                selectedFile = null;
            }
            
            // Show typing indicator
            typingIndicator.style.display = 'block';
            
            try {
                // ä½¿ç”¨èŠå¤©API
                const result = await chat.sendMessage(parts);
                const response = await result.response;
                const responseText = response.text();
                
                // Hide typing indicator and add bot response
                typingIndicator.style.display = 'none';
                addBotMessage(responseText);
                
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                typingIndicator.style.display = 'none';
                
                // ä½¿ç”¨å¤‡é€‰å“åº”
                const fallbackResponses = [
                    "ä½œä¸ºéæœºåŠ¨è½¦æ™ºèƒ½ç›‘æ§ç³»ç»Ÿçš„åŠ©æ‰‹ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨è§£ç­”å…³äºéæœºåŠ¨è½¦ç®¡ç†å’Œè¿è§„è¡Œä¸ºçš„é—®é¢˜ã€‚",
                    "æˆ‘ä»¬çš„ç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«å¤šç§è¿è§„è¡Œä¸ºï¼ŒåŒ…æ‹¬é—¯çº¢ç¯ã€é€†è¡Œå’Œå ç”¨æœºåŠ¨è½¦é“ç­‰ã€‚æ‚¨æœ‰ä»€ä¹ˆå…·ä½“æƒ³äº†è§£çš„å—ï¼Ÿ",
                    "éæœºåŠ¨è½¦ç®¡ç†æ˜¯åŸå¸‚äº¤é€šç§©åºçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æˆ‘å¯ä»¥ä¸ºæ‚¨æä¾›ç›¸å…³æ³•è§„å’Œå¤„ç½šä¿¡æ¯ã€‚"
                ];
                const randomResponse = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
                addBotMessage(randomResponse);
            }
        }
        
        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        
        chatInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
        
        // ç”¨æˆ·èµ„æ–™ç›¸å…³åŠŸèƒ½
        function setupProfileFunctions() {
            // å¤´åƒä¸Šä¼ åŠŸèƒ½
            const avatarUpload = document.getElementById('avatar-upload');
            const profileImage = document.getElementById('profile-image');
            
            avatarUpload.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    profileImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
            
            // ç¼–è¾‘èµ„æ–™æ¨¡æ€çª—å£
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const editProfileModal = document.getElementById('edit-profile-modal');
            const editProfileClose = document.getElementById('edit-profile-close');
            const editProfileForm = document.getElementById('edit-profile-form');
            
            editProfileBtn.addEventListener('click', function() {
                editProfileModal.style.display = 'flex';
            });
            
            editProfileClose.addEventListener('click', function() {
                editProfileModal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === editProfileModal) {
                    editProfileModal.style.display = 'none';
                }
            });
            
            editProfileForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // è·å–è¡¨å•æ•°æ®
                const name = document.getElementById('edit-name').value;
                const position = document.getElementById('edit-position').value;
                const phone = document.getElementById('edit-phone').value;
                const email = document.getElementById('edit-email').value;
                const department = document.getElementById('edit-department').value;
                
                // æ›´æ–°ä¸ªäººèµ„æ–™æ˜¾ç¤º
                document.getElementById('user-name').textContent = name;
                document.getElementById('user-position').textContent = `äº¤é€šè­¦å«å¤„ Â· ${position}`;
                document.getElementById('user-phone').textContent = phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
                document.getElementById('user-email').textContent = email;
                document.getElementById('user-department').textContent = department;
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                alert('ä¸ªäººèµ„æ–™å·²æ›´æ–°');
                
                // å…³é—­æ¨¡æ€çª—å£
                editProfileModal.style.display = 'none';
            });
            
            // æŠ¥å‘Šé—®é¢˜æ¨¡æ€çª—å£
            const reportIssueBtn = document.getElementById('report-issue-btn');
            const reportIssueModal = document.getElementById('report-issue-modal');
            const reportIssueClose = document.getElementById('report-issue-close');
            const reportIssueForm = document.getElementById('report-issue-form');
            
            reportIssueBtn.addEventListener('click', function() {
                reportIssueModal.style.display = 'flex';
            });
            
            reportIssueClose.addEventListener('click', function() {
                reportIssueModal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === reportIssueModal) {
                    reportIssueModal.style.display = 'none';
                }
            });
            
            reportIssueForm.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // è·å–è¡¨å•æ•°æ®
                const issueType = document.getElementById('issue-type').value;
                const issueTitle = document.getElementById('issue-title').value;
                const issueDescription = document.getElementById('issue-description').value;
                
                // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥å°†é—®é¢˜æäº¤åˆ°æœåŠ¡å™¨
                console.log('é—®é¢˜ç±»å‹:', issueType);
                console.log('é—®é¢˜æ ‡é¢˜:', issueTitle);
                console.log('é—®é¢˜æè¿°:', issueDescription);
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                alert('é—®é¢˜æŠ¥å‘Šå·²æäº¤ï¼Œæ„Ÿè°¢æ‚¨çš„åé¦ˆï¼');
                
                // é‡ç½®è¡¨å•
                reportIssueForm.reset();
                
                // å…³é—­æ¨¡æ€çª—å£
                reportIssueModal.style.display = 'none';
            });
        }
        
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        menuToggle.addEventListener('click', () => sidebar.classList.toggle('active'));
        
        // å¯¼èˆªæŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('home-btn').addEventListener('click', () => {
            window.location.href = 'login.html';  // è·³è½¬åˆ°testç›®å½•ä¸‹çš„login.html
        });

        document.getElementById('dashboard-btn').addEventListener('click', () => {
            window.location.href = 'modified-code.html';  // è·³è½¬åˆ°testç›®å½•ä¸‹çš„modified-code.html
        });

        document.getElementById('details-btn').addEventListener('click', () => {
            window.location.href = 'details.html';  // è·³è½¬åˆ°testç›®å½•ä¸‹çš„details.html
        });

        document.getElementById('vlm-btn').addEventListener('click', () => {
            // å·²ç»åœ¨æ™ºèƒ½äº¤äº’é¡µï¼Œä¸éœ€è¦è·³è½¬
        });

        document.getElementById('review-btn').addEventListener('click', () => {
            createModal('<h3>ç³»ç»Ÿé€šçŸ¥</h3><p style="margin-top: 20px;">å·²é€šçŸ¥ç›¸å…³æŠ€æœ¯äººå‘˜</p>');
        });

        document.getElementById('contact-btn').addEventListener('click', () => {
            createModal('<h3>è”ç³»æ–¹å¼</h3><p style="margin-top: 20px; line-height: 1.6;">ç”µè¯ï¼š400-123-4567<br>é‚®ç®±ï¼šsupport@ainonmotor.com<br>åœ°å€ï¼šç§‘æŠ€å›­åŒº88å·äººå·¥æ™ºèƒ½å¤§å¦</p>');
        });
        
        // åˆå§‹åŒ–
        window.onload = function() {
            // è®¾ç½®ç”¨æˆ·èµ„æ–™åŠŸèƒ½
            setupProfileFunctions();
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        };
    </script>
</body>
</html>